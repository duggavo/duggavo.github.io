let setTab,translation={};async function loadTranslation(){l=navigator.languages[0]||navigator.language||navigator.userLanguage,"it-IT"===l||"it-CH"===l||"it"===l?await fetchTranslation("it"):await fetchTranslation("en"),main()}function fetchTranslation(t){return new Promise(n=>{fetch("translations/"+t+".json").then(t=>t.json()).then(t=>{translation=t,n()})})}function main(){const t=1.5,n=.002;document.getElementById("buy").innerText=translation.buy,document.getElementById("sell").innerText=translation.sell;const o=document.getElementById("myChart");let a=new Chart(o,{type:"line",data:{labels:[],datasets:[{label:translation.price+" ($)",data:[],borderWidth:1}]},options:{elements:{point:{hitRadius:30,radius:0},line:{stepped:!1}}}});o.style.display="none";let l=["btc","xmr","ltc","eth","wow","bnb"],s={btc:"bitcoin",xmr:"monero",ltc:"litecoin",eth:"ethereum",wow:"wownero",bnb:"binancecoin"};function c(t){window.localStorage.setItem("bals",JSON.stringify(t))}function r(){const t=window.localStorage.getItem("bals");if("string"==typeof t){let n=JSON.parse(t),e={};for(i in e.usd=n.usd,s)e[i]=n[i]||0;return console.log("z:",e),e}{let t={usd:1e3};for(i of l)t[i]=0;return t}}let d={};function u(){let e=[];for(i in s)e.push(s[i]);console.log("n:",e.join(",")),fetch("https://api.coingecko.com/api/v3/simple/price?ids="+e.join(",")+"&vs_currencies=usd").then(t=>t.json()).then(e=>{(d=e).simulatedVolatility={usd:d.bitcoin.usd**t*n},p()})}function m(t){return d[s[t]].usd}function p(){let t=r();const n=document.getElementById("coins");n.innerHTML=`\n<tr>\n\t<th>${translation.coin}</th>\n\t<th>${translation.bal}</th>\n\t<th>${translation.bal} ($)</th>\n</tr>\n`;let e=0;for(i in t){const o=t[i];let a="<tr ",l=o;"usd"!=i&&(a+=`id=coin_${i} onclick=setTab("${i}") `,l*=m(i)),e+=l,n.innerHTML+=a+`class=coin><td>${i.toUpperCase()}</td><td>${o.toPrecision(4)}</td><td>${l.toPrecision(4)}</td></tr>`}document.getElementById("bal").innerText=e.toFixed(2)}function h(t){let n=prompt(translation.how_much_buy);(n=parseFloat(n))&&(!function(t,n){const e=m(t);b=r(),n>b.usd?alert(translation.not_enough_funds):!n||n<0?alert(translation.place_bigger):(b[t]+=n/e,b.usd-=n,c(b))}(t,n),p())}function g(t){let n=prompt(translation.how_much_sell.replace("%x",t.toUpperCase()));0===(n=parseFloat(n))&&(n=r()[t],console.log("amount is "+n)),n&&(!function(t,n){const e=m(t);b=r(),b[t]<n?alert(translation.not_enough_funds):!n||n<0?alert(translation.place_bigger):(b[t]-=n,b.usd+=n*e,c(b))}(t,n),p())}u(),setInterval(u,3e4);let y="";setTab=((i,l=!1)=>{l||(document.getElementById("myChart").style.display="none",document.getElementById("coinInfo").style.display="none"),document.getElementById("coinName").innerText=`${function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(s[i])} (${i.toUpperCase()})`,document.getElementById("buy").onclick=(()=>{h(i)}),document.getElementById("sell").onclick=(()=>{g(i)}),y=i,function(i){let l=document.getElementById("time").value,c=1,r=1;"sim"===i&&(i="btc",c=t,r=n),fetch("https://api.coingecko.com/api/v3/coins/"+s[i]+"/market_chart?vs_currency=usd&days="+l).then(t=>t.json()).then(t=>{let n=[],i=[];for(e of t.prices)n.push(""),i.push(e[1]**c*r);a.data.labels=n,a.data.datasets[0].data=i,a.update("none"),o.style.display="block",document.getElementById("coinInfo").style.display="block"})}(i)}),document.getElementById("time").onchange=(()=>{setTab(y,!0)}),setInterval(()=>{""==y||document.hidden||setTab(y,!0)},6e4)}loadTranslation();